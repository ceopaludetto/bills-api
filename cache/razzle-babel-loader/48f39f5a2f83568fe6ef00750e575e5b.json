{"ast":null,"code":"\"use strict\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar _a, _b;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthenticationService = void 0;\n\nconst common_1 = require(\"@nestjs/common\");\n\nconst jwt_1 = require(\"@nestjs/jwt\");\n\nconst user_1 = require(\"@/modules/user\");\n\nlet AuthenticationService = class AuthenticationService {\n  constructor(userService, jwtService) {\n    _defineProperty(this, \"userService\", void 0);\n\n    _defineProperty(this, \"jwtService\", void 0);\n\n    this.userService = userService;\n    this.jwtService = jwtService;\n  }\n\n  async genToken(user) {\n    return this.jwtService.signAsync({\n      id: user.id,\n      email: user.email\n    });\n  }\n\n  async validatePayload(payload) {\n    const user = await this.userService.findByID(payload.id);\n    if (!user) throw new common_1.NotFoundException(\"user-not-found\");\n    if (user.email !== payload.email) throw new common_1.UnprocessableEntityException(\"email-mismatch\");\n    return user;\n  }\n\n  async login({\n    email,\n    password\n  }) {\n    const user = await this.userService.findByEmail(email);\n    if (!user) throw new common_1.NotFoundException(\"user-not-found\");\n    if (!(await user.comparePassword(password))) throw new common_1.BadRequestException(\"incorrect-password\");\n    const token = await this.genToken(user);\n    return user;\n  }\n\n  async register(data, res) {\n    const user = await this.userService.create(data);\n    const token = await this.genToken(user);\n    res.header(\"Authorization\", token);\n    return user;\n  }\n\n};\nAuthenticationService = __decorate([(0, common_1.Injectable)(), __metadata(\"design:paramtypes\", [typeof (_a = typeof user_1.UserService !== \"undefined\" && user_1.UserService) === \"function\" ? _a : Object, typeof (_b = typeof jwt_1.JwtService !== \"undefined\" && jwt_1.JwtService) === \"function\" ? _b : Object])], AuthenticationService);\nexports.AuthenticationService = AuthenticationService;","map":{"version":3,"sources":["/Users/carlos/Documents/Projetos/Javascript/bills_api/src/modules/authentication/authentication.service.ts"],"names":["_a","_b","Object","defineProperty","exports","value","AuthenticationService","common_1","require","jwt_1","user_1","constructor","userService","jwtService","genToken","user","signAsync","id","email","validatePayload","payload","findByID","NotFoundException","UnprocessableEntityException","login","password","findByEmail","comparePassword","BadRequestException","token","register","data","res","create","header","__decorate","Injectable","__metadata","UserService","JwtService"],"mappings":"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","sourcesContent":["\"use strict\";\nvar _a, _b;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthenticationService = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst jwt_1 = require(\"@nestjs/jwt\");\nconst user_1 = require(\"@/modules/user\");\nlet AuthenticationService = class AuthenticationService {\n    userService;\n    jwtService;\n    constructor(userService, jwtService) {\n        this.userService = userService;\n        this.jwtService = jwtService;\n    }\n    async genToken(user) {\n        return this.jwtService.signAsync({ id: user.id, email: user.email });\n    }\n    async validatePayload(payload) {\n        const user = await this.userService.findByID(payload.id);\n        if (!user)\n            throw new common_1.NotFoundException(\"user-not-found\");\n        if (user.email !== payload.email)\n            throw new common_1.UnprocessableEntityException(\"email-mismatch\");\n        return user;\n    }\n    async login({ email, password }) {\n        const user = await this.userService.findByEmail(email);\n        if (!user)\n            throw new common_1.NotFoundException(\"user-not-found\");\n        if (!(await user.comparePassword(password)))\n            throw new common_1.BadRequestException(\"incorrect-password\");\n        const token = await this.genToken(user);\n        return user;\n    }\n    async register(data, res) {\n        const user = await this.userService.create(data);\n        const token = await this.genToken(user);\n        res.header(\"Authorization\", token);\n        return user;\n    }\n};\nAuthenticationService = __decorate([\n    (0, common_1.Injectable)(),\n    __metadata(\"design:paramtypes\", [typeof (_a = typeof user_1.UserService !== \"undefined\" && user_1.UserService) === \"function\" ? _a : Object, typeof (_b = typeof jwt_1.JwtService !== \"undefined\" && jwt_1.JwtService) === \"function\" ? _b : Object])\n], AuthenticationService);\nexports.AuthenticationService = AuthenticationService;\n"]},"metadata":{},"sourceType":"script"}