{"ast":null,"code":"\"use strict\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar _a, _b, _c, _d, _e;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthenticationResolver = void 0;\n\nconst common_1 = require(\"@nestjs/common\");\n\nconst graphql_1 = require(\"@nestjs/graphql\");\n\nconst passport_jwt_1 = require(\"passport-jwt\");\n\nconst models_1 = require(\"@/models\");\n\nconst user_1 = require(\"@/modules/user\");\n\nconst authentication_decorator_1 = require(\"./authentication.decorator\");\n\nconst authentication_dto_1 = require(\"./authentication.dto\");\n\nconst authentication_guard_1 = require(\"./authentication.guard\");\n\nconst authentication_service_1 = require(\"./authentication.service\");\n\nlet AuthenticationResolver = class AuthenticationResolver {\n  constructor(authenticationService, userService) {\n    _defineProperty(this, \"authenticationService\", void 0);\n\n    _defineProperty(this, \"userService\", void 0);\n\n    this.authenticationService = authenticationService;\n    this.userService = userService;\n  }\n\n  async profile(user) {\n    return this.userService.findByID(user.id);\n  }\n\n  async login(data, {\n    res\n  }) {\n    return this.authenticationService.login(data, res);\n  }\n\n  async register(data, {\n    res\n  }) {\n    return this.authenticationService.register(data, res);\n  }\n\n  async checkToken({\n    req\n  }) {\n    const token = passport_jwt_1.ExtractJwt.fromAuthHeaderAsBearerToken()(req);\n    if (!token) throw new common_1.UnauthorizedException(\"token-not-found\");\n    return this.authenticationService.checkToken(token);\n  }\n\n};\n\n__decorate([(0, common_1.UseGuards)(authentication_guard_1.GqlAuthenticationGuard), (0, graphql_1.Query)(() => models_1.User), __param(0, (0, authentication_decorator_1.CurrentUser)()), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_a = typeof models_1.User !== \"undefined\" && models_1.User) === \"function\" ? _a : Object]), __metadata(\"design:returntype\", Promise)], AuthenticationResolver.prototype, \"profile\", null);\n\n__decorate([(0, graphql_1.Mutation)(() => models_1.User), __param(0, (0, graphql_1.Args)(\"input\")), __param(1, (0, graphql_1.Context)()), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_b = typeof authentication_dto_1.AuthenticationLoginInput !== \"undefined\" && authentication_dto_1.AuthenticationLoginInput) === \"function\" ? _b : Object, Object]), __metadata(\"design:returntype\", Promise)], AuthenticationResolver.prototype, \"login\", null);\n\n__decorate([(0, graphql_1.Mutation)(() => models_1.User), __param(0, (0, graphql_1.Args)(\"input\")), __param(1, (0, graphql_1.Context)()), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [typeof (_c = typeof authentication_dto_1.AuthenticationRegisterInput !== \"undefined\" && authentication_dto_1.AuthenticationRegisterInput) === \"function\" ? _c : Object, Object]), __metadata(\"design:returntype\", Promise)], AuthenticationResolver.prototype, \"register\", null);\n\n__decorate([(0, common_1.UseGuards)(authentication_guard_1.GqlAuthenticationGuard), (0, graphql_1.Query)(() => Boolean), __param(0, (0, graphql_1.Context)()), __metadata(\"design:type\", Function), __metadata(\"design:paramtypes\", [Object]), __metadata(\"design:returntype\", Promise)], AuthenticationResolver.prototype, \"checkToken\", null);\n\nAuthenticationResolver = __decorate([(0, graphql_1.Resolver)(() => models_1.User), __metadata(\"design:paramtypes\", [typeof (_d = typeof authentication_service_1.AuthenticationService !== \"undefined\" && authentication_service_1.AuthenticationService) === \"function\" ? _d : Object, typeof (_e = typeof user_1.UserService !== \"undefined\" && user_1.UserService) === \"function\" ? _e : Object])], AuthenticationResolver);\nexports.AuthenticationResolver = AuthenticationResolver;","map":{"version":3,"sources":["/Users/carlos/Documents/Projetos/Javascript/bills_api/src/modules/authentication/authentication.resolver.ts"],"names":["_a","_b","_c","_d","_e","Object","defineProperty","exports","value","AuthenticationResolver","common_1","require","graphql_1","passport_jwt_1","models_1","user_1","authentication_decorator_1","authentication_dto_1","authentication_guard_1","authentication_service_1","constructor","authenticationService","userService","profile","user","findByID","id","login","data","res","register","checkToken","req","token","ExtractJwt","fromAuthHeaderAsBearerToken","UnauthorizedException","__decorate","UseGuards","GqlAuthenticationGuard","Query","User","__param","CurrentUser","__metadata","Function","Promise","prototype","Mutation","Args","Context","AuthenticationLoginInput","AuthenticationRegisterInput","Boolean","Resolver","AuthenticationService","UserService"],"mappings":"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","sourcesContent":["\"use strict\";\nvar _a, _b, _c, _d, _e;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthenticationResolver = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst graphql_1 = require(\"@nestjs/graphql\");\nconst passport_jwt_1 = require(\"passport-jwt\");\nconst models_1 = require(\"@/models\");\nconst user_1 = require(\"@/modules/user\");\nconst authentication_decorator_1 = require(\"./authentication.decorator\");\nconst authentication_dto_1 = require(\"./authentication.dto\");\nconst authentication_guard_1 = require(\"./authentication.guard\");\nconst authentication_service_1 = require(\"./authentication.service\");\nlet AuthenticationResolver = class AuthenticationResolver {\n    authenticationService;\n    userService;\n    constructor(authenticationService, userService) {\n        this.authenticationService = authenticationService;\n        this.userService = userService;\n    }\n    async profile(user) {\n        return this.userService.findByID(user.id);\n    }\n    async login(data, { res }) {\n        return this.authenticationService.login(data, res);\n    }\n    async register(data, { res }) {\n        return this.authenticationService.register(data, res);\n    }\n    async checkToken({ req }) {\n        const token = passport_jwt_1.ExtractJwt.fromAuthHeaderAsBearerToken()(req);\n        if (!token)\n            throw new common_1.UnauthorizedException(\"token-not-found\");\n        return this.authenticationService.checkToken(token);\n    }\n};\n__decorate([\n    (0, common_1.UseGuards)(authentication_guard_1.GqlAuthenticationGuard),\n    (0, graphql_1.Query)(() => models_1.User),\n    __param(0, (0, authentication_decorator_1.CurrentUser)()),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [typeof (_a = typeof models_1.User !== \"undefined\" && models_1.User) === \"function\" ? _a : Object]),\n    __metadata(\"design:returntype\", Promise)\n], AuthenticationResolver.prototype, \"profile\", null);\n__decorate([\n    (0, graphql_1.Mutation)(() => models_1.User),\n    __param(0, (0, graphql_1.Args)(\"input\")),\n    __param(1, (0, graphql_1.Context)()),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [typeof (_b = typeof authentication_dto_1.AuthenticationLoginInput !== \"undefined\" && authentication_dto_1.AuthenticationLoginInput) === \"function\" ? _b : Object, Object]),\n    __metadata(\"design:returntype\", Promise)\n], AuthenticationResolver.prototype, \"login\", null);\n__decorate([\n    (0, graphql_1.Mutation)(() => models_1.User),\n    __param(0, (0, graphql_1.Args)(\"input\")),\n    __param(1, (0, graphql_1.Context)()),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [typeof (_c = typeof authentication_dto_1.AuthenticationRegisterInput !== \"undefined\" && authentication_dto_1.AuthenticationRegisterInput) === \"function\" ? _c : Object, Object]),\n    __metadata(\"design:returntype\", Promise)\n], AuthenticationResolver.prototype, \"register\", null);\n__decorate([\n    (0, common_1.UseGuards)(authentication_guard_1.GqlAuthenticationGuard),\n    (0, graphql_1.Query)(() => Boolean),\n    __param(0, (0, graphql_1.Context)()),\n    __metadata(\"design:type\", Function),\n    __metadata(\"design:paramtypes\", [Object]),\n    __metadata(\"design:returntype\", Promise)\n], AuthenticationResolver.prototype, \"checkToken\", null);\nAuthenticationResolver = __decorate([\n    (0, graphql_1.Resolver)(() => models_1.User),\n    __metadata(\"design:paramtypes\", [typeof (_d = typeof authentication_service_1.AuthenticationService !== \"undefined\" && authentication_service_1.AuthenticationService) === \"function\" ? _d : Object, typeof (_e = typeof user_1.UserService !== \"undefined\" && user_1.UserService) === \"function\" ? _e : Object])\n], AuthenticationResolver);\nexports.AuthenticationResolver = AuthenticationResolver;\n"]},"metadata":{},"sourceType":"script"}