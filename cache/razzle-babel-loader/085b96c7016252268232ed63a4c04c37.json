{"ast":null,"code":"\"use strict\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar _a, _b;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthenticationService = void 0;\n\nconst common_1 = require(\"@nestjs/common\");\n\nconst jwt_1 = require(\"@nestjs/jwt\");\n\nconst user_1 = require(\"@/modules/user\");\n\nlet AuthenticationService = class AuthenticationService {\n  constructor(userService, jwtService) {\n    _defineProperty(this, \"userService\", void 0);\n\n    _defineProperty(this, \"jwtService\", void 0);\n\n    this.userService = userService;\n    this.jwtService = jwtService;\n  }\n\n  async validatePayload(payload) {\n    const user = await this.userService.findByID(payload.id);\n    if (!user) throw new common_1.NotFoundException(\"user-not-found\");\n    if (user.email !== payload.email) throw new common_1.UnprocessableEntityException(\"email-mismatch\");\n    return user;\n  }\n\n  async login({\n    email,\n    password\n  }) {\n    const user = await this.userService.findByEmail(email);\n    if (!user) throw new common_1.NotFoundException(\"user-not-found\");\n    if (!(await user.comparePassword(password))) throw new common_1.BadRequestException(\"incorrect-password\");\n    return user;\n  }\n\n  async register(data, res) {\n    const user = await this.userService.create(data);\n    const token = await this.jwtService.signAsync({\n      id: user.id,\n      email: user.email\n    });\n    res.header(\"Authorization\", token);\n    return user;\n  }\n\n};\nAuthenticationService = __decorate([(0, common_1.Injectable)(), __metadata(\"design:paramtypes\", [typeof (_a = typeof user_1.UserService !== \"undefined\" && user_1.UserService) === \"function\" ? _a : Object, typeof (_b = typeof jwt_1.JwtService !== \"undefined\" && jwt_1.JwtService) === \"function\" ? _b : Object])], AuthenticationService);\nexports.AuthenticationService = AuthenticationService;","map":{"version":3,"sources":["/Users/carlos/Documents/Projetos/Javascript/bills_api/src/modules/authentication/authentication.service.ts"],"names":["_a","_b","Object","defineProperty","exports","value","AuthenticationService","common_1","require","jwt_1","user_1","constructor","userService","jwtService","validatePayload","payload","user","findByID","id","NotFoundException","email","UnprocessableEntityException","login","password","findByEmail","comparePassword","BadRequestException","register","data","res","create","token","signAsync","header","__decorate","Injectable","__metadata","UserService","JwtService"],"mappings":"AAAA;;;;AACA,IAAIA,EAAJ,EAAQC,EAAR;;AACAC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,qBAAR,GAAgC,KAAK,CAArC;;AACA,MAAMC,QAAQ,GAAGC,OAAO,CAAC,gBAAD,CAAxB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAC,aAAD,CAArB;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAC,gBAAD,CAAtB;;AACA,IAAIF,qBAAqB,GAAG,MAAMA,qBAAN,CAA4B;AAGpDK,EAAAA,WAAW,CAACC,WAAD,EAAcC,UAAd,EAA0B;AAAA;;AAAA;;AACjC,SAAKD,WAAL,GAAmBA,WAAnB;AACA,SAAKC,UAAL,GAAkBA,UAAlB;AACH;;AACoB,QAAfC,eAAe,CAACC,OAAD,EAAU;AAC3B,UAAMC,IAAI,GAAG,MAAM,KAAKJ,WAAL,CAAiBK,QAAjB,CAA0BF,OAAO,CAACG,EAAlC,CAAnB;AACA,QAAI,CAACF,IAAL,EACI,MAAM,IAAIT,QAAQ,CAACY,iBAAb,CAA+B,gBAA/B,CAAN;AACJ,QAAIH,IAAI,CAACI,KAAL,KAAeL,OAAO,CAACK,KAA3B,EACI,MAAM,IAAIb,QAAQ,CAACc,4BAAb,CAA0C,gBAA1C,CAAN;AACJ,WAAOL,IAAP;AACH;;AACU,QAALM,KAAK,CAAC;AAAEF,IAAAA,KAAF;AAASG,IAAAA;AAAT,GAAD,EAAsB;AAC7B,UAAMP,IAAI,GAAG,MAAM,KAAKJ,WAAL,CAAiBY,WAAjB,CAA6BJ,KAA7B,CAAnB;AACA,QAAI,CAACJ,IAAL,EACI,MAAM,IAAIT,QAAQ,CAACY,iBAAb,CAA+B,gBAA/B,CAAN;AACJ,QAAI,EAAE,MAAMH,IAAI,CAACS,eAAL,CAAqBF,QAArB,CAAR,CAAJ,EACI,MAAM,IAAIhB,QAAQ,CAACmB,mBAAb,CAAiC,oBAAjC,CAAN;AACJ,WAAOV,IAAP;AACH;;AACa,QAARW,QAAQ,CAACC,IAAD,EAAOC,GAAP,EAAY;AACtB,UAAMb,IAAI,GAAG,MAAM,KAAKJ,WAAL,CAAiBkB,MAAjB,CAAwBF,IAAxB,CAAnB;AACA,UAAMG,KAAK,GAAG,MAAM,KAAKlB,UAAL,CAAgBmB,SAAhB,CAA0B;AAAEd,MAAAA,EAAE,EAAEF,IAAI,CAACE,EAAX;AAAeE,MAAAA,KAAK,EAAEJ,IAAI,CAACI;AAA3B,KAA1B,CAApB;AACAS,IAAAA,GAAG,CAACI,MAAJ,CAAW,eAAX,EAA4BF,KAA5B;AACA,WAAOf,IAAP;AACH;;AA5BmD,CAAxD;AA8BAV,qBAAqB,GAAG4B,UAAU,CAAC,CAC/B,CAAC,GAAG3B,QAAQ,CAAC4B,UAAb,GAD+B,EAE/BC,UAAU,CAAC,mBAAD,EAAsB,CAAC,QAAQpC,EAAE,GAAG,OAAOU,MAAM,CAAC2B,WAAd,KAA8B,WAA9B,IAA6C3B,MAAM,CAAC2B,WAAjE,MAAkF,UAAlF,GAA+FrC,EAA/F,GAAoGE,MAArG,EAA6G,QAAQD,EAAE,GAAG,OAAOQ,KAAK,CAAC6B,UAAb,KAA4B,WAA5B,IAA2C7B,KAAK,CAAC6B,UAA9D,MAA8E,UAA9E,GAA2FrC,EAA3F,GAAgGC,MAA7M,CAAtB,CAFqB,CAAD,EAG/BI,qBAH+B,CAAlC;AAIAF,OAAO,CAACE,qBAAR,GAAgCA,qBAAhC","sourcesContent":["\"use strict\";\nvar _a, _b;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthenticationService = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst jwt_1 = require(\"@nestjs/jwt\");\nconst user_1 = require(\"@/modules/user\");\nlet AuthenticationService = class AuthenticationService {\n    userService;\n    jwtService;\n    constructor(userService, jwtService) {\n        this.userService = userService;\n        this.jwtService = jwtService;\n    }\n    async validatePayload(payload) {\n        const user = await this.userService.findByID(payload.id);\n        if (!user)\n            throw new common_1.NotFoundException(\"user-not-found\");\n        if (user.email !== payload.email)\n            throw new common_1.UnprocessableEntityException(\"email-mismatch\");\n        return user;\n    }\n    async login({ email, password }) {\n        const user = await this.userService.findByEmail(email);\n        if (!user)\n            throw new common_1.NotFoundException(\"user-not-found\");\n        if (!(await user.comparePassword(password)))\n            throw new common_1.BadRequestException(\"incorrect-password\");\n        return user;\n    }\n    async register(data, res) {\n        const user = await this.userService.create(data);\n        const token = await this.jwtService.signAsync({ id: user.id, email: user.email });\n        res.header(\"Authorization\", token);\n        return user;\n    }\n};\nAuthenticationService = __decorate([\n    (0, common_1.Injectable)(),\n    __metadata(\"design:paramtypes\", [typeof (_a = typeof user_1.UserService !== \"undefined\" && user_1.UserService) === \"function\" ? _a : Object, typeof (_b = typeof jwt_1.JwtService !== \"undefined\" && jwt_1.JwtService) === \"function\" ? _b : Object])\n], AuthenticationService);\nexports.AuthenticationService = AuthenticationService;\n"]},"metadata":{},"sourceType":"script"}