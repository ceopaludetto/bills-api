{"version":3,"file":"server.66e49269b47efcd94937.hot-update.js","sources":["webpack://bills_api/./src/modules/authentication/authentication.service.ts","webpack://bills_api/webpack/runtime/getFullHash"],"sourcesContent":["var _a, _b;\nimport { Injectable, NotFoundException, BadRequestException, UnprocessableEntityException } from \"@nestjs/common\";\nimport { JwtService } from \"@nestjs/jwt\";\nimport { UserService } from \"@/modules/user\";\nlet AuthenticationService = class AuthenticationService {\n    userService;\n    jwtService;\n    constructor(userService, jwtService) {\n        this.userService = userService;\n        this.jwtService = jwtService;\n    }\n    async genToken(user) {\n        return this.jwtService.signAsync({ id: user.id, email: user.email });\n    }\n    async validatePayload(payload) {\n        const user = await this.userService.findByID(payload.id);\n        if (!user)\n            throw new NotFoundException(\"user-not-found\");\n        if (user.email !== payload.email)\n            throw new UnprocessableEntityException(\"email-mismatch\");\n        return user;\n    }\n    async login({ email, password }, res) {\n        const user = await this.userService.findByEmail(email);\n        if (!user)\n            throw new NotFoundException(\"user-not-found\");\n        if (!(await user.comparePassword(password)))\n            throw new BadRequestException(\"incorrect-password\");\n        const token = await this.genToken(user);\n        res.header(\"Authorization\", token);\n        return user;\n    }\n    async register(data, res) {\n        const user = await this.userService.create(data);\n        const token = await this.genToken(user);\n        res.header(\"Authorization\", token);\n        return user;\n    }\n};\nAuthenticationService = __decorate([\n    Injectable(),\n    __metadata(\"design:paramtypes\", [typeof (_a = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _a : Object, typeof (_b = typeof JwtService !== \"undefined\" && JwtService) === \"function\" ? _b : Object])\n], AuthenticationService);\nexport { AuthenticationService };\n","__webpack_require__.h = () => (\"b8ad4fada955afb05179\")"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;AAGA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAlCA;AAmCA;;;A;;;;;;;;;ACvCA;;;;A","sourceRoot":""}